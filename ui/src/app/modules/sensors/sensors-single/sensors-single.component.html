<div class="box-wrapper">
  <div class="sensor box w-100">
    <form
      [formGroup]="sensorForm"
      class="m-0"
      [ngClass]="{'mb-3': !create}"
      enctype="multipart/form-data"
    >
      <div class="row p-0">
        <div class="col-12 col-lg-7 col-xl-8">
          <div>
            <div class="row m-0">
              <div class="p-0 col-12 col-xl-4 order-0 order-xl-1">
                <input
                  class="text-start text-xl-end"
                  type="text"
                  id="name"
                  minlength="2"
                  maxlength="128"
                  formControlName="name"
                  placeholder="NAME_SENSOR"

                />
                <span id="id"> {{ getIdFormat() }} </span>

              </div>
              <input
                class="p-0 col-12 col-xl-8 order-1 order-xl-0"
                type="text"
                id="displayName"
                minlength="5"
                maxlength="255"
                formControlName="displayName"
                placeholder="Designation"
              />
              <input
                class="p-0 col-12 order-2"
                type="text"
                id="subDisplayName"
                minlength="5"
                maxlength="255"
                placeholder="Indications"
                formControlName="subDisplayName"
              />
            </div>
            <div>
              <div class="pos">
                <div class="me-2">
                  <p class="d-block d-sm-none">Lat.</p>
                  <label for="latitude" class="d-none d-sm-block"
                  >Latitude</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="latitude"
                    formControlName="latitude"
                  />
                </div>
                <div>
                  <p class="d-block d-sm-none">Lng.</p>
                  <label for="longitude" class="d-none d-sm-block"
                  >Longitude</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="longitude"
                    formControlName="longitude"
                  />
                </div>
              </div>
            </div>
          </div>
          <div>
            <mat-form-field appearance="fill" *ngIf="create">
              <mat-label>Type du capteur</mat-label>
              <mat-select
              required formControlName="sensorMetadata"
              (ngModelChange)="onChangeMetadata($event)">
                <mat-option>--</mat-option>
                <mat-option *ngFor="let smd of sensorsMetadata" [value]="smd">
                  <img [src]="
                    smd?.id
                    ? ('/public/sensors/metadata/' + smd?.id + '/image' | secure | async)
                    : NO_IMG
                  "
                  width="24"
                  height="24"
                  (window:resize)="0"/> {{ smd.name }} ({{smd.version}})
                </mat-option>
              </mat-select>
              <!-- <mat-error *ngIf="animalControl.hasError('required')">Please choose an animal</mat-error> -->
              <!--<mat-hint>{{animalControl.value?.sound}}</mat-hint> -->
            </mat-form-field>

            <h2 *ngIf="!create" class="m-0 p-0">{{ metadata?.name }} {{ metadata?.version }}</h2>
            <p *ngIf="!create" class="input-align">{{ metadata?.description }}</p>
          </div>
        </div>
        <div class="col-12 col-lg-5 col-xl-4 row pb-3 m-0">
          <div class="col-4 p-0 pe-2">
            <img
              class="sensor-metadata-logo"
              #sensorMetadataImg
              (window:resize)="0"
              [src]="
                metadata?.id
                ? ('/public/sensors/metadata/' + metadata?.id + '/image'
                  | secure
                  | async)
                : NO_IMG
              "
              style="width: 100%"
            />
          </div>
          <div class="col-4 p-0 px-1">
            <app-input-image
              (image)="photo = $event"
              name="photo"
              [default]="defaultUrl"
              [extendSrc]="id? ['/sensors', id, 'photo']: undefined"
              [editable]="edition"
            ></app-input-image>
          </div>
          <div class="col-4 p-0 ps-2">
            <div
              id="map-sensors-single"
              [ngStyle]="{
                'width.px': getSize(),
                'height.px': getSize()
              }"
            ></div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12" [ngClass]="{ 'col-md-6': editable || create }">
          <strong>Description</strong>
          <div class="description" >
            <textarea
              type="text"
              id="description"
              placeholder="Aucune description"
              formControlName="description"
            ></textarea>
          </div>
        </div>
        <div class="col-12 col-md-6" *ngIf="editable || create">
          <strong>Description de maintenance</strong>
          <div class="description">
            <textarea
              type="text"
              id="maintenanceDescription"
              placeholder="Aucune description"
              formControlName="maintenanceDescription"
            ></textarea>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <app-dialog class="download col mb-3 me-3" *ngIf="!create">
            <app-button width="130" fa="fas fa-cloud-download" trigger>
              Télécharger
            </app-button>

            <div body>
              <div class="buttons">
                <app-button
                  url="assets/buttons/csv.svg"
                  class="me-3"
                  (click)="onDownloadCSV()"
                  #close
                >
                  CSV
                </app-button>
                <app-button
                  url="assets/buttons/json.svg"
                  (click)="onDownloadJSON()"
                  #close
                >
                  JSON
                </app-button>
                <app-button
                  *ngIf="editable"
                  url="assets/buttons/binary.svg"
                  (click)="onDownloadBinary()"
                  width="120"
                  class="ms-3"
                  #close
                >
                  Programme
                </app-button>
              </div>
            </div>
          </app-dialog>

          <app-button
            *ngIf="id"
            width="130"
            fa="fas fa-chart-bar"
            class="edit col mb-3 me-3"
            [link]="['/sensors', id, 'graph']"
          >
            Graphiques
          </app-button>

          <app-button
            width="130"
            url="/assets/buttons/edit.svg"
            class="edit col mb-3 me-3"
            (click)="onEdition(); $event.stopPropagation()"
            *ngIf="!edition && auth.isUser() && editable"
          >
            Editer
          </app-button>

          <app-button
            width="130"
            *ngIf="edition && auth.isUser()"
            fa="fas fa-cloud-upload"
            class="edit col mb-3 me-3"
            (click)="onSave(); $event.stopPropagation()"
          >
            Sauvegarder
          </app-button>

          <div class="error col-12 col-md mb-3" *ngIf="messageError">
            {{ messageError }}
          </div>
        </div>
      </div>

      <div class="m-0 p-0" [ngClass]="{ 'd-none': create }">
        <app-data-table
          class="p-0"
          [length]="parameters?.total"
          [scales]="[25, 50, 100]"
          sortable="SERVER"
          pagable="SERVER"
          [sizes]="sizes()"
          [data]="parameters?.values || []"
          [formater]="formater"
          [empty]="'Aucune donnée à afficher'"
          [headers]="metadata?.parameters?.headers || []"
          (navigate)="onChange($event)"
          [height]="525"
        >
        </app-data-table>
      </div>
    </form>
  </div>
</div>
